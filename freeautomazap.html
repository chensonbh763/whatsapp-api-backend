<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Automa√ß√£o WhatsApp</title>
  <script src="https://libtl.com/sdk.js" data-zone="9579151" data-sdk="show_9579151"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    margin: 0;
    padding: 20px;
  }

  .container {
    max-width: 800px;
    margin: auto;
    background: #fff;
    padding: 20px;
    border-radius: 8px;
  }

  section {
    margin-bottom: 30px;
  }

  h2 {
    margin-bottom: 10px;
    color: #333;
  }

  .image-box {
    width: 200px;
    height: 200px;
    background-color: #eee;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 10px;
    border: 2px dashed #ccc;
    text-align: center;
  }

  textarea {
    width: 100%;
    height: 100px;
    padding: 10px;
    resize: none;
  }

  select {
    width: 100%;
    padding: 5px;
    margin-bottom: 10px;
  }

  button {
    padding: 10px 20px;
    margin-right: 10px;
    background-color: #0078D4;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }

  button:hover {
    background-color: #005a9e;
  }

  #statusConexao {
    margin-top: 10px;
    font-weight: bold;
    color: #555;
  }

  /* Novos estilos para Sess√£o 5 */
  .enviar p {
    margin: 5px 0;
    font-size: 14px;
    color: #444;
  }

  #ultimaMensagem {
    font-style: italic;
  }

  #resumoEnvio {
    font-weight: bold;
    color: #0078D4;
  }
</style>
</head>
<body>
  <div class="container">

    <!-- Sess√£o 0: Cabe√ßalho -->
    <section class="cabecalho">
      <h2>Automa√ß√£o WhatsApp</h2>
      <p>Este sistema permite enviar mensagens autom√°ticas para grupos do seu WhatsApp com imagem, texto e temporizador. Clique em "Verificar" para checar a conex√£o com o servidor e o status do WhatsApp.</p>
      <button id="verificar">Verificar</button>
      <p id="statusConexao">Status: aguardando verifica√ß√£o...</p>
    </section>

    <!-- Sess√£o 1: Imagem -->
    <section class="imagem">
      <h2>Imagem</h2>
      <div id="preview" class="image-box">Pr√©-visualiza√ß√£o</div>
      <input type="file" id="imageInput" accept="image/*">
    </section>

    <!-- Sess√£o 2: Texto -->
    <section class="texto">
      <h2>Mensagem</h2>
      <textarea id="mensagem" placeholder="Digite sua mensagem aqui..."></textarea>
    </section>

    <!-- Sess√£o 3: Grupos -->
<section class="grupos">
  <h2>Grupos</h2>
  <div class="grupo-selecao">
    <label for="grupo1">Grupo 1:</label>
    <select id="grupo1">
      <option value="">Selecione</option>
    </select>
  </div>
  <div class="grupo-selecao">
    <label for="grupo2">Grupo 2:</label>
    <select id="grupo2">
      <option value="">Selecione</option>
    </select>
  </div>
  <div class="grupo-selecao">
    <label for="grupo3">Grupo 3:</label>
    <select id="grupo3">
      <option value="">Selecione</option>
    </select>
  </div>
  <div class="grupo-selecao">
    <label for="grupo4">Grupo 4:</label>
    <select id="grupo4">
      <option value="">Selecione</option>
    </select>
  </div>
  <div class="grupo-selecao">
    <label for="grupo5">Grupo 5:</label>
    <select id="grupo5">
      <option value="">Selecione</option>
    </select>
  </div>
</section>
    ...
    <!-- Sess√£o Monetag -->
    <section class="monetag">
      <h2>Desbloquear envio</h2>
      <p>Para enviar mensagens, √© necess√°rio assistir a um an√∫ncio.</p>
      <button id="assistirAnuncio">Assistir an√∫ncio</button>
      <p id="statusAnuncio" style="color: green; font-weight: bold;">An√∫ncio n√£o assistido</p>
    </section>


<!-- Sess√£o 5: Enviar -->
<section class="enviar">
  <h2>Status</h2>
  <p id="status">Aguardando mensagem...</p>
  <p id="ultimaMensagem">√öltima mensagem enviada: --:--</p>
  <p id="resumoEnvio">Mensagens enviadas: 0 de 5</p>
  <button id="enviar" disabled>Enviar</button>
</section>

  </div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // ‚úÖ Verificar conex√£o com servidor
    document.getElementById("verificar").addEventListener("click", async () => {
      try {
        const resposta = await fetch("http://localhost:3000/verificar");
        const dados = await resposta.json();
        document.getElementById("statusConexao").textContent = `Status: ${dados.status}`;
      } catch (erro) {
        document.getElementById("statusConexao").textContent = "Status: erro ao verificar conex√£o";
        console.error("Erro na verifica√ß√£o:", erro);
      }
    });

    // üñºÔ∏è Pr√©-visualiza√ß√£o da imagem
    const imageInput = document.getElementById("imageInput");
    const preview = document.getElementById("preview");

    imageInput.addEventListener("change", () => {
      const file = imageInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = () => {
          preview.innerHTML = `<img src="${reader.result}" style="max-width:100%; max-height:100%;">`;
        };
        reader.readAsDataURL(file);
      } else {
        preview.innerHTML = "Pr√©-visualiza√ß√£o";
      }
    });

    // üì• Carregar grupos dinamicamente
    async function carregarGrupos() {
      try {
        const resposta = await fetch("http://localhost:3000/grupos");
        const grupos = await resposta.json();

        for (let i = 1; i <= 5; i++) {
          const select = document.getElementById(`grupo${i}`);
          select.innerHTML = '<option value="">Selecione</option>';

          grupos.forEach(grupo => {
            const option = document.createElement("option");
            option.value = grupo.id;
            option.textContent = grupo.name;
            select.appendChild(option);
          });
        }
      } catch (erro) {
        console.error("Erro ao carregar grupos:", erro);
      }
    }

    carregarGrupos(); // üöÄ Chamar ao carregar a p√°gina

    // üé• Controle do an√∫ncio Monetag
    let anuncioAssistido = false;

    document.getElementById("assistirAnuncio").addEventListener("click", () => {
      show_9579151().then(() => {
        anuncioAssistido = true;
        document.getElementById("statusAnuncio").textContent = "‚úÖ An√∫ncio assistido!";
        document.getElementById("enviar").disabled = false;
      });
    });

    // üì§ Envio da mensagem
document.getElementById("enviar").addEventListener("click", async () => {
  if (!anuncioAssistido) {
    alert("Voc√™ precisa assistir ao an√∫ncio antes de enviar.");
    return;
  }

  const mensagem = document.getElementById("mensagem").value;
  const grupos = [];
  for (let i = 1; i <= 5; i++) {
    const valor = document.getElementById(`grupo${i}`).value;
    if (valor) grupos.push(valor);
  }

  const formData = new FormData();
  formData.append("mensagem", mensagem);
  formData.append("grupos", JSON.stringify(grupos));
  formData.append("assistiuVideo", "true");

  if (imageInput.files[0]) {
    formData.append("imagem", imageInput.files[0]);
  }

  try {
    const resposta = await fetch("http://localhost:3000/enviar", {
      method: "POST",
      body: formData
    });

    const resultado = await resposta.json();
    document.getElementById("status").textContent = resultado.mensagem || "Mensagem enviada!";
    document.getElementById("ultimaMensagem").textContent = `√öltima mensagem enviada: ${new Date().toLocaleTimeString()}`;
    document.getElementById("resumoEnvio").textContent = `Mensagens enviadas: ${grupos.length} de 10`;

    // üîÅ Resetar estado ap√≥s envio
    anuncioAssistido = false;
    document.getElementById("statusAnuncio").textContent = "An√∫ncio n√£o assistido";
    document.getElementById("enviar").disabled = true;

  } catch (erro) {
    console.error("Erro ao enviar:", erro);
    document.getElementById("status").textContent = "Erro ao enviar mensagem.";
  }
});
</script>



</body>
</html>




















